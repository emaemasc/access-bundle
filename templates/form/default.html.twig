{% block emaemasc_access_widget %}
    {% dump %}
    <div>
        <label class="form-control-label">{{ label }}</label>
        <div class="emaemasc-access-container" {{ block('widget_container_attributes') }}>
            {% if presets|length > 0 %}
                <div class="emaemasc-access-presets">
                <span class="emaemasc-access-preset" data-name="empty" data-items="[]">
                    Пусто
                </span>
                    {% for preset in presets %}
                        <span class="emaemasc-access-preset"
                              data-name="{{ preset.name }}"
                              data-items="{{ preset.items|json_encode }}">
                        {{ preset.title }}
                    </span>
                    {% endfor %}
                </div>
            {% endif %}
            <div class="emaemasc-access-inner">
                {% if groups|length > 0 %}
                    {% for group in groups %}
                        {{ _self.emaemasc_access_group(form, items, group) }}
                    {% endfor %}
                {% else %}
                    {% for item in items %}
                        {{ _self.emaemasc_access_item(form, items, item.name) }}
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}

{% block emaemasc_access_row %}
    {# This block is intentionally empty to prevent individual field rendering #}
    {{ block('emaemasc_access_widget') }}
{% endblock %}

{% block emaemasc_access_errors %}
    {# This block is intentionally empty or you can customize error display #}
{% endblock %}

{% block emaemasc_access_label %}
    {# This block is intentionally empty to prevent label rendering #}
{% endblock %}

{% macro emaemasc_access_group(form, items, group) %}
    <div class="emaemasc-access-group">
        <div class="emaemasc-access-group-header">
            <span class="emaemasc-access-group-title">{{ group.title }}</span>
        </div>
        <div class="emaemasc-access-group-items">
            {% for itemId in group.items %}
                {{ _self.emaemasc_access_item(form, items, itemId) }}
            {% endfor %}
        </div>
    </div>
{% endmacro %}

{% macro emaemasc_access_item(form, items, itemId) %}
    {% if items[itemId] is defined %}
        {% set item = items[itemId] %}
        {% set checkboxId = form['item_' ~ itemId].vars.id %}
        <div class="emaemasc-access-row">
            <div class="emaemasc-access-title">
                {{ item.title }}
            </div>
            <div class="emaemasc-access-switch">
                <div class="emaemasc-toggle-wrapper">
                    {{ form_widget(form['item_' ~ itemId], {
                        'attr': {
                            'class': 'emaemasc-toggle-input',
                            'data-item-id': itemId,
                            'data-item-name': item.name,
                            'data-item-title': item.title
                        }
                    }) }}
                </div>
            </div>
        </div>
    {% endif %}
{% endmacro %}
